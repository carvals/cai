<Page x:Class="UnoApp4.Presentation.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:UnoApp4.Presentation"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:um="using:Uno.Material"
      NavigationCacheMode="Required"
      Background="{ThemeResource BackgroundBrush}">
  <!-- No storyboard resources: using direct width updates for reliability across Skia/Windows -->
  <Grid utu:SafeArea.Insets="VisibleBounds">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <!-- Top Navigation Bar (if needed for page title) -->
    <utu:NavigationBar Content="{Binding Title}" />

    <!-- Main Content Area: Sidebar | Left Panel | Splitter | Right Panel -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <!-- Far-left sidebar (fixed width) -->
        <ColumnDefinition Width="56" />
        <!-- Left panel column (collapsible/resizable) -->
        <ColumnDefinition x:Name="LeftPanelColumn" Width="Auto" />
        <!-- Splitter column -->
        <ColumnDefinition Width="Auto" />
        <!-- Right panel column -->
        <ColumnDefinition Width="*" MinWidth="320" />
      </Grid.ColumnDefinitions>

      <!-- Sidebar: vertical strip with the toggle icon at the very far left -->
      <Border Grid.Column="0" Background="{ThemeResource LayerFillColorDefaultBrush}">
        <StackPanel Orientation="Vertical" Spacing="8" HorizontalAlignment="Center" VerticalAlignment="Stretch">
          <StackPanel Spacing="8" Margin="0,12,0,0">
            <!-- Toggle left panel visibility button (plus over document metaphor approximated) -->
            <Button x:Name="ToggleLeftPanelButton" Click="ToggleLeftPanelButton_Click" ToolTipService.ToolTip="Afficher/masquer le panneau de gauche" Style="{StaticResource AccentButtonStyle}" Width="36" Height="36" Background="Transparent">
              <StackPanel>
                <SymbolIcon Symbol="Add" HorizontalAlignment="Center" />
                <SymbolIcon Symbol="Page" HorizontalAlignment="Center" />
              </StackPanel>
            </Button>
          </StackPanel>

          <!-- Fill remaining space -->
          <StackPanel VerticalAlignment="Stretch" />
        </StackPanel>
      </Border>

      <!-- Left Panel: "Espace de travail" card -->
      <Border x:Name="LeftPanel" Grid.Column="1" Width="360"
              Margin="12,0,12,0"
              Background="{ThemeResource LayerFillColorDefaultBrush}"
              BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>

          <!-- Card header -->
          <Border Padding="12,10" CornerRadius="8,8,0,0" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <TextBlock Text="Espace de travail" FontWeight="SemiBold" />
          </Border>

          <!-- First row of actions: Ajouter / Rechercher -->
          <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="16" Padding="12,12,12,8">
            <Button x:Name="BtnUpload" Click="BtnUpload_Click">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <SymbolIcon Symbol="Add" />
                <TextBlock Text="Ajouter un fichier" />
              </StackPanel>
            </Button>
            <Button>
              <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xE721;" />
                <TextBlock Text="Rechercher un fichier" />
              </StackPanel>
            </Button>
          </StackPanel>

          <!-- Second row: Créer un document -->
          <StackPanel Grid.Row="2" Padding="12,0,12,12">
            <Button HorizontalAlignment="Left">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <SymbolIcon Symbol="Edit" />
                <TextBlock Text="Créer un document" />
              </StackPanel>
            </Button>

            <!-- Placeholder content area below the divider line -->
            <Border Margin="0,16,0,0" Height="1" Background="{ThemeResource ControlStrokeColorDefaultBrush}" />
          </StackPanel>
        </Grid>
      </Border>

      <!-- Splitter between left and right panels (custom Thumb-based) -->
      <Border Grid.Column="2" Width="4" Background="{ThemeResource ControlStrokeColorDefaultBrush}">
        <Thumb x:Name="LeftRightThumb" DragDelta="LeftRightThumb_DragDelta" />
      </Border>

      <!-- Right Panel: Chat card -->
      <Border Grid.Column="3"
              Margin="0,0,12,0"
              Background="{ThemeResource LayerFillColorDefaultBrush}"
              BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!-- Chat header with actions -->
          <Grid Padding="12,10">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Chat" FontWeight="SemiBold" />
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
              <AppBarButton Icon="SaveLocal" Label="Exporter" />
              <AppBarButton Icon="Delete" Label="Vider" />
            </StackPanel>
          </Grid>

          <!-- Empty state -->
          <Grid Grid.Row="1">
            <TextBlock Text="No messages here yet" Opacity="0.6" HorizontalAlignment="Center" VerticalAlignment="Center" />
            <TextBlock Text="Send a message to chat with AI" Opacity="0.4" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,24,0,0" />
          </Grid>

          <!-- Input area -->
          <Grid Grid.Row="2" Padding="12,12" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="0,0,8,8">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBox PlaceholderText="Type a message" Margin="0,0,8,0" />
            <Button Grid.Column="1" Content="Send" />
          </Grid>
        </Grid>
      </Border>
    </Grid>

    <!-- Upload dialog -->
    <ContentDialog x:Name="UploadDialog"
                 Title="Charger le contenu d'un fichier"
                 PrimaryButtonText="Fermer"
                 IsPrimaryButtonEnabled="True"
                 DefaultButton="Primary">
      <ScrollViewer>
        <StackPanel Spacing="16">
        <!-- Top row: Drop zone + action buttons -->
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280" />
            <ColumnDefinition Width="16" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>

          <!-- Drag & Drop Zone / Select -->
          <Border Grid.Column="0" Padding="16" CornerRadius="8" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Border AllowDrop="True" Padding="12" BorderThickness="2" CornerRadius="8"
                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                    DragOver="DropZone_DragOver" Drop="DropZone_Drop" Tapped="DropZone_Tapped">
              <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                <FontIcon Glyph="&#xE721;" FontSize="28" />
                <TextBlock Text="Select or drag and drop" HorizontalAlignment="Center" />
              </StackPanel>
            </Border>
          </Border>

          <!-- Actions on the right -->
          <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12" VerticalAlignment="Top">
            <Button x:Name="BtnToText" Content="Convertir en text brut" Click="BtnToText_Click" />
            <Button x:Name="BtnSummarize" Content="Faire un résumé" IsEnabled="False" />
            <Button x:Name="BtnReset" Content="Reset" Click="BtnReset_Click" />
          </StackPanel>
        </Grid>

        <!-- Save button -->
        <Button x:Name="BtnSave" Content="Sauvegarder" HorizontalAlignment="Stretch" Click="BtnSave_Click" />

        <!-- Preview Section -->
        <StackPanel>
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Preview" FontWeight="SemiBold" VerticalAlignment="Center" />
            <ToggleSwitch x:Name="PreviewToggle" Grid.Column="1" Margin="12,0,0,0" />
            <TextBlock Grid.Column="2" Text="Text brut / Résumé" VerticalAlignment="Center" Opacity="0.6" />
          </Grid>

          <Border Margin="0,8,0,0" Background="{ThemeResource LayerFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                  BorderThickness="1" CornerRadius="8">
            <TextBox x:Name="PreviewText" Text="pas de donnée" TextWrapping="Wrap" AcceptsReturn="True" MinHeight="120" Padding="12" />
          </Border>
        </StackPanel>
      </StackPanel>
    </ScrollViewer>
    </ContentDialog>
  </Grid>
</Page>
