<Page x:Class="CAI_design_1_chat.Presentation.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:CAI_design_1_chat.Presentation"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:um="using:Uno.Material"
      NavigationCacheMode="Required"
      Background="{ThemeResource MaterialBackgroundBrush}">
  
  <Grid utu:SafeArea.Insets="VisibleBounds">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    
    <!-- Navigation Bar -->
    <utu:NavigationBar Grid.Row="0" Content="Chat" />
    
    <!-- Main Content Grid -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <!-- Fixed far-left sidebar (61px) -->
        <ColumnDefinition Width="61" />
        <!-- Left panel (collapsible) -->
        <ColumnDefinition x:Name="LeftPanelColumn" Width="360" />
        <!-- Splitter -->
        <ColumnDefinition x:Name="SplitterColumn" Width="Auto" />
        <!-- Right panel (chat) -->
        <ColumnDefinition Width="*" MinWidth="320" />
      </Grid.ColumnDefinitions>
      
      <!-- Far-left Sidebar (icons only) -->
      <Border Grid.Column="0" 
              Background="{ThemeResource MaterialSurfaceBrush}"
              BorderBrush="{ThemeResource MaterialOutlineBrush}"
              BorderThickness="0,0,1,0">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          
          <!-- Toggle button for left panel -->
          <Button x:Name="ToggleLeftPanelButton"
                  Grid.Row="0"
                  Click="ToggleLeftPanelButton_Click"
                  Background="{ThemeResource MaterialPrimaryBrush}"
                  BorderBrush="{ThemeResource MaterialPrimaryBrush}"
                  BorderThickness="2"
                  CornerRadius="6"
                  Width="48"
                  Height="48"
                  Margin="6,8,6,0"
                  ToolTipService.ToolTip="Toggle workspace panel">
            <StackPanel>
              <SymbolIcon Symbol="Add" HorizontalAlignment="Center" />
              <SymbolIcon Symbol="Page" HorizontalAlignment="Center" />
            </StackPanel>
          </Button>
          
          <!-- Settings section with expandable menu -->
          <StackPanel x:Name="SettingsSection" Grid.Row="2" Margin="6,0,6,4">
              <!-- Settings Button -->
              <Button x:Name="SettingsButton"
                      Click="SettingsButton_Click"
                      Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                      BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      CornerRadius="6"
                      Width="48"
                      Height="48"
                      ToolTipService.ToolTip="Settings">
                <FontIcon Glyph="⚙" 
                          Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                          FontSize="20" />
              </Button>
            
            <!-- Expandable settings menu -->
            <StackPanel x:Name="SettingsMenu"
                        Visibility="Collapsed"
                        Margin="0,4,0,0">
              
              <!-- Notifications -->
              <Button x:Name="NotificationsButton"
                      Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                      BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      CornerRadius="6"
                      Width="48"
                      Height="48"
                      Margin="0,0,0,4"
                      ToolTipService.ToolTip="Notifications">
                <FontIcon Glyph="🔔" 
                          Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                          FontSize="18" />
              </Button>
              
              <!-- Theme -->
              <Button x:Name="ThemeButton"
                      Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                      BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      CornerRadius="6"
                      Width="48"
                      Height="48"
                      Margin="0,0,0,4"
                      ToolTipService.ToolTip="Theme">
                <FontIcon Glyph="☀" 
                          Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                          FontSize="18" />
              </Button>
              
              <!-- Help -->
              <Button x:Name="HelpButton"
                      Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                      BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      CornerRadius="6"
                      Width="48"
                      Height="48"
                      Margin="0,0,0,4"
                      ToolTipService.ToolTip="Help">
                <FontIcon Glyph="❓" 
                          Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                          FontSize="18" />
              </Button>
              
              <!-- AI Settings -->
              <Button x:Name="AISettingsButton"
                      Click="AISettingsButton_Click"
                      Background="{ThemeResource MaterialPrimaryContainerBrush}"
                      BorderBrush="{ThemeResource MaterialPrimaryBrush}"
                      BorderThickness="1"
                      CornerRadius="6"
                      Width="48"
                      Height="48"
                      ToolTipService.ToolTip="AI Settings">
                <FontIcon Glyph="🤖" 
                          Foreground="{ThemeResource MaterialPrimaryBrush}"
                          FontSize="18" />
              </Button>
              
            </StackPanel>
          </StackPanel>
          
          <!-- Login avatar at bottom -->
          <Button x:Name="LoginAvatarButton"
                  Grid.Row="3"
                  Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="24"
                  Width="48"
                  Height="48"
                  Margin="6,0,6,8"
                  ToolTipService.ToolTip="User profile">
            <PersonPicture Width="40" Height="40" />
          </Button>
        </Grid>
      </Border>
      
      <!-- Left Panel: Espace de travail -->
      <Border x:Name="LeftPanel"
              Grid.Column="1"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Margin="8">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          
          <!-- Header -->
          <Border Grid.Row="0"
                  Background="{ThemeResource LayerFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                  BorderThickness="0,0,0,1"
                  CornerRadius="8,8,0,0"
                  Padding="16,12">
            <TextBlock Text="Espace de travail"
                       FontWeight="SemiBold"
                       FontSize="16" />
          </Border>
          
          <!-- Content -->
          <StackPanel Grid.Row="1" 
                      Margin="16"
                      Spacing="8">
            
            
            <Button x:Name="BtnAddFile"
                    HorizontalAlignment="Stretch"
                    Background="{ThemeResource MaterialSurfaceVariantBrush}"
                    BorderBrush="{ThemeResource MaterialPrimaryBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="12,8"
                    Click="BtnAddFile_Click">
              <Button.Resources>
                <SolidColorBrush x:Key="ButtonForeground" Color="{ThemeResource TextFillColorPrimaryBrush}" />
                <SolidColorBrush x:Key="ButtonForegroundPointerOver" Color="{ThemeResource TextFillColorPrimaryBrush}" />
                <SolidColorBrush x:Key="ButtonForegroundPressed" Color="{ThemeResource TextFillColorPrimaryBrush}" />
              </Button.Resources>
              <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xE109;" FontSize="16" Foreground="{ThemeResource AccentFillColorDefaultBrush}" />
                <TextBlock Text="Ajouter un fichier" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontWeight="Medium" />
              </StackPanel>
            </Button>
            
            <!-- Rechercher un fichier button -->
            <Button x:Name="BtnSearchFile"
                    HorizontalAlignment="Stretch"
                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="12,8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xE11A;" FontSize="16" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                <TextBlock Text="Rechercher un fichier" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontWeight="Medium" />
              </StackPanel>
            </Button>
            
            <!-- Créer un document button -->
            <Button x:Name="BtnCreateDocument"
                    HorizontalAlignment="Stretch"
                    Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                    BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="12,8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xE8A5;" FontSize="16" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                <TextBlock Text="Créer un document" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontWeight="Medium" />
              </StackPanel>
            </Button>
            
          </StackPanel>
        </Grid>
      </Border>
      
      <!-- Splitter -->
      <Border x:Name="Splitter"
              Grid.Column="2"
              Width="4"
              Background="{ThemeResource ControlStrokeColorDefaultBrush}"
              HorizontalAlignment="Center"
              VerticalAlignment="Stretch" />
      
      <!-- Right Panel: Chat -->
      <Border Grid.Column="3"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="1"
              CornerRadius="8"
              Margin="8">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          
          <!-- Chat Header -->
          <Border Grid.Row="0"
                  Background="{ThemeResource LayerFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                  BorderThickness="0,0,0,1"
                  CornerRadius="8,8,0,0"
                  Padding="16,12">
            <Grid>
              <TextBlock Text="Chat"
                         FontWeight="SemiBold"
                         FontSize="16"
                         HorizontalAlignment="Left" />
              <StackPanel Orientation="Horizontal"
                          HorizontalAlignment="Right"
                          Spacing="8">
                <Button Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        ToolTipService.ToolTip="Download">
                  <FontIcon Glyph="&#xE118;" FontSize="14" />
                </Button>
                <Button Background="Transparent"
                        BorderThickness="0"
                        Width="32"
                        Height="32"
                        ToolTipService.ToolTip="More options">
                  <FontIcon Glyph="&#xE10C;" FontSize="14" />
                </Button>
              </StackPanel>
            </Grid>
          </Border>
          
          <!-- Chat Messages Area -->
          <Grid Grid.Row="1">
            <ScrollViewer x:Name="ChatScrollViewer"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          ZoomMode="Disabled"
                          Padding="16,8">
            <StackPanel x:Name="ChatMessagesPanel"
                        Spacing="12">
              
              <!-- Empty State (shown when no messages) -->
              <StackPanel x:Name="EmptyStatePanel"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Spacing="8"
                          Margin="0,40">
                <TextBlock Text="No messages here yet"
                           FontSize="16"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Send a message to chat with AI"
                           FontSize="14"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>
              
              <!-- Sample User Message -->
              <!-- 
              <Grid HorizontalAlignment="Right" MaxWidth="400" Margin="0,4">
                <Border Background="{ThemeResource AccentFillColorDefaultBrush}"
                        CornerRadius="16,16,4,16"
                        Padding="12,8">
                  <TextBlock Text="Hello, can you help me with something?"
                             Foreground="White"
                             TextWrapping="Wrap"
                             FontSize="14" />
                </Border>
              </Grid>
              -->
              
              <!-- Sample AI Message -->
              <!--
              <Grid HorizontalAlignment="Left" MaxWidth="500" Margin="0,4">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                
                <Border Grid.Row="0"
                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="16,16,16,4"
                        Padding="12,8">
                  <TextBlock Text="Of course! I'd be happy to help you. What do you need assistance with?"
                             Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                             TextWrapping="Wrap"
                             FontSize="14" />
                </Border>
                
                <StackPanel Grid.Row="1" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Right"
                            Margin="0,4,0,0"
                            Spacing="8">
                  <Button Background="Transparent"
                          BorderThickness="0"
                          Padding="8,4"
                          ToolTipService.ToolTip="Copy message">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                      <FontIcon Glyph="&#xE8C8;" FontSize="12" />
                      <TextBlock Text="Copy" FontSize="12" />
                    </StackPanel>
                  </Button>
                </StackPanel>
              </Grid>
              -->
              
            </StackPanel>
          </ScrollViewer>
          
          <!-- Scroll to Bottom Indicator -->
          <Button x:Name="ScrollIndicator"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Bottom"
                  Margin="16,0,16,16"
                  Background="{ThemeResource AccentFillColorDefaultBrush}"
                  BorderThickness="0"
                  CornerRadius="20"
                  Width="40"
                  Height="40"
                  Visibility="Collapsed"
                  Click="ScrollIndicator_Click"
                  ToolTipService.ToolTip="Scroll to bottom">
            <FontIcon Glyph="&#xE96E;" 
                      Foreground="White" 
                      FontSize="16" />
          </Button>
          </Grid>
          
          <!-- Chat Input Area -->
          <Border Grid.Row="2"
                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                  BorderThickness="0,1,0,0"
                  Padding="16,12">
            <Grid>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              
              <TextBox x:Name="ChatInput"
                       Grid.Column="0"
                       PlaceholderText="Type a message"
                       BorderThickness="1"
                       CornerRadius="20"
                       Padding="16,8"
                       VerticalAlignment="Center"
                       KeyDown="ChatInput_KeyDown" />
              
              <Button x:Name="SendButton"
                      Grid.Column="1"
                      Background="{ThemeResource AccentFillColorDefaultBrush}"
                      BorderThickness="0"
                      CornerRadius="20"
                      Width="40"
                      Height="40"
                      Margin="8,0,0,0"
                      Click="SendButton_Click"
                      ToolTipService.ToolTip="Send message">
                <FontIcon Glyph="&#xE122;" FontSize="16" Foreground="White" />
              </Button>
            </Grid>
          </Border>
          
        </Grid>
      </Border>
      
    </Grid>
  </Grid>
</Page>
