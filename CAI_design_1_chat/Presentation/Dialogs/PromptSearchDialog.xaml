<?xml version="1.0" encoding="utf-8"?>
<ContentDialog x:Class="CAI_design_1_chat.Presentation.Dialogs.PromptSearchDialog"
               xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               Title="Select Prompt Instruction"
               PrimaryButtonText="Select"
               SecondaryButtonText="Cancel"
               DefaultButton="Primary"
               Background="{ThemeResource MaterialSurfaceBrush}"
               Foreground="{ThemeResource MaterialOnSurfaceBrush}"
               BorderBrush="{ThemeResource MaterialOutlineVariantBrush}"
               CornerRadius="12"
               MaxWidth="800"
               MaxHeight="600">

    <Grid Margin="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search and Filter Controls -->
        <StackPanel Grid.Row="0" Spacing="12">
            <TextBox x:Name="SearchTextBox"
                     PlaceholderText="Search in title and description..."
                     Background="{ThemeResource MaterialSurfaceVariantBrush}"
                     BorderBrush="{ThemeResource MaterialOutlineVariantBrush}"
                     BorderThickness="1"
                     CornerRadius="8"
                     Padding="12"
                     TextChanged="SearchTextBox_TextChanged"/>
            
            <ComboBox x:Name="PromptTypeComboBox"
                      PlaceholderText="Filter by Type"
                      Background="{ThemeResource MaterialSurfaceVariantBrush}"
                      BorderBrush="{ThemeResource MaterialOutlineVariantBrush}"
                      BorderThickness="1"
                      CornerRadius="8"
                      Padding="12"
                      MinWidth="200"
                      SelectionChanged="PromptTypeComboBox_SelectionChanged">
                <ComboBoxItem Content="All Types" Tag="all"/>
                <ComboBoxItem Content="Summary" Tag="summary"/>
                <ComboBoxItem Content="Extraction" Tag="extraction"/>
                <ComboBoxItem Content="Analysis" Tag="analysis"/>
                <ComboBoxItem Content="Custom" Tag="custom"/>
            </ComboBox>
        </StackPanel>

        <!-- Results List -->
        <ScrollViewer Grid.Row="1" 
                      Background="{ThemeResource MaterialSurfaceBrush}"
                      BorderBrush="{ThemeResource MaterialOutlineVariantBrush}"
                      BorderThickness="1"
                      CornerRadius="8"
                      Padding="8">
            <ListView x:Name="PromptsListView"
                      Background="Transparent"
                      SelectionMode="Single"
                      SelectionChanged="PromptsListView_SelectionChanged">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{ThemeResource MaterialSurfaceVariantBrush}"
                                BorderBrush="{ThemeResource MaterialOutlineVariantBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16"
                                Margin="4">
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Spacing="4">
                                    <TextBlock Text="{Binding Title}"
                                               Style="{ThemeResource SubtitleTextBlockStyle}"
                                               Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Description}"
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                                               TextWrapping="Wrap"
                                               MaxLines="2"/>
                                </StackPanel>

                                <Border Grid.Column="1"
                                        Background="{ThemeResource MaterialPrimaryContainerBrush}"
                                        CornerRadius="4"
                                        Padding="8,4">
                                    <TextBlock Text="{Binding PromptType}"
                                               Style="{ThemeResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource MaterialOnPrimaryContainerBrush}"
                                               FontWeight="Medium"/>
                                </Border>

                                <TextBlock Grid.Column="2"
                                           Text="{Binding Language}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                                           FontWeight="Medium"
                                           VerticalAlignment="Center"/>

                                <TextBlock Grid.Column="3"
                                           Text="{Binding UsageText}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                                           VerticalAlignment="Center"/>

                                <FontIcon Grid.Column="4"
                                          Glyph="&#xE915;"
                                          FontSize="16"
                                          Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                                          VerticalAlignment="Center"
                                          Visibility="{Binding IsSystem, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </ScrollViewer>

        <!-- Preview Section -->
        <Border Grid.Row="2"
                Background="{ThemeResource MaterialSurfaceVariantBrush}"
                BorderBrush="{ThemeResource MaterialOutlineVariantBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16"
                MinHeight="100">
            <StackPanel Spacing="8">
                <TextBlock Text="Preview:"
                           Style="{ThemeResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                           FontWeight="SemiBold"/>
                <ScrollViewer MaxHeight="80"
                              VerticalScrollBarVisibility="Auto">
                    <TextBlock x:Name="PreviewTextBlock"
                               Text="Select a prompt to preview its instruction..."
                               Style="{ThemeResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource MaterialOnSurfaceVariantBrush}"
                               TextWrapping="Wrap"/>
                </ScrollViewer>
            </StackPanel>
        </Border>
    </Grid>
</ContentDialog>
